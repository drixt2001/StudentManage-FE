<ul nz-menu nzMode="horizontal">
  <li nz-menu-item nzSelected (click)="changeTab('profile')">
    <span nz-icon nzType="user" nzTheme="outline"></span>
    Thông Tin
  </li>

  <li *ngIf="isEdit" nz-menu-item (click)="changeTab('pictures')">
    <span nz-icon nzType="picture" nzTheme="outline"></span>
    Ảnh Cá Nhân
  </li>
</ul>

<div class="container">
  <div *ngIf="selectedTab === 'profile'" class="profile bar">
    <div class="profile content">
      <div class="profile avatar">
        <nz-avatar [nzSize]="300" nzIcon="user"></nz-avatar>
      </div>

      <form
        [formGroup]="personalForm"
        class="profile form"
        nz-form
        [nzLayout]="'vertical'"
      >
        <nz-form-item>
          <nz-form-label [nzSpan]="null">Email </nz-form-label>
          <nz-form-control [nzSpan]="null">
            <input
              formControlName="email"
              nz-input
              placeholder="ID@hce.edu.vn"
            />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSpan]="null" nzFor="password"
            >Mật khẩu</nz-form-label
          >
          <nz-form-control [nzSpan]="null">
            <nz-input-group [nzSuffix]="suffixTemplate">
              <input
                [type]="passwordVisible ? 'text' : 'password'"
                nz-input
                formControlName="password"
                placeholder="Tối thiểu 6 ký tự"
              />
            </nz-input-group>
          </nz-form-control>
          <ng-template #suffixTemplate>
            <span
              nz-icon
              [nzType]="passwordVisible ? 'eye-invisible' : 'eye'"
              (click)="passwordVisible = !passwordVisible"
            ></span>
          </ng-template>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSpan]="null"
            >Mã
            {{
              selectedRoleStudent ? "Sinh Viên" : "Giảng Viên"
            }}</nz-form-label
          >
          <nz-form-control [nzSpan]="null">
            <input
              formControlName="id"
              [readonly]="isEdit"
              nz-input
              placeholder="19K4081028"
            />
          </nz-form-control>
        </nz-form-item>
      </form>

      <form
        [formGroup]="personalForm"
        class="profile form"
        nz-form
        [nzLayout]="'vertical'"
      >
        <nz-form-item>
          <nz-form-label [nzSpan]="null">Họ và Tên</nz-form-label>
          <nz-form-control [nzSpan]="null">
            <input formControlName="name" nz-input placeholder="Nguyễn Văn A" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSpan]="null">Ngày Sinh</nz-form-label>
          <nz-form-control [nzSpan]="null">
            <nz-date-picker formControlName="birthday"></nz-date-picker>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSpan]="null">Địa Chỉ</nz-form-label>
          <nz-form-control [nzSpan]="null">
            <input
              formControlName="address"
              nz-input
              placeholder="Nguyễn Văn A"
            />
          </nz-form-control>
        </nz-form-item>
      </form>

      <form
        [formGroup]="personalForm"
        class="profile form"
        nz-form
        [nzLayout]="'vertical'"
      >
        <nz-form-item>
          <nz-form-label [nzSpan]="null">Khoa</nz-form-label>
          <nz-form-control [nzSpan]="null">
            <nz-select
              formControlName="department"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="Khoa"
              (ngModelChange)="changeDepartment()"
            >
              <nz-option
                *ngFor="let department of departmentData"
                [nzLabel]="department.name"
                [nzValue]="department.id"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item *ngIf="selectedRoleStudent">
          <nz-form-label [nzSpan]="null">Lớp</nz-form-label>
          <nz-form-control [nzSpan]="null">
            <nz-select
              formControlName="class"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="Lớp"
            >
              <nz-option
                *ngFor="let class of classData"
                [nzLabel]="class.name"
                [nzValue]="class.id"
              ></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item *ngIf="!selectedRoleStudent">
          <nz-form-label [nzSpan]="null">Chức Vụ</nz-form-label>
          <nz-form-control [nzSpan]="null">
            <nz-select
              formControlName="role"
              nzShowSearch
              nzAllowClear
              nzPlaceHolder="Chức Vụ"
            >
              <nz-option nzLabel="Giảng Viên" nzValue="Giảng Viên"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label [nzSpan]="null">Tổng Số Ảnh</nz-form-label>
          <nz-form-control [nzSpan]="null">
            <input
              formControlName="countPictures"
              [readonly]="true"
              nz-input
              placeholder="Số Ảnh Huấn Luyện"
            />
          </nz-form-control>
        </nz-form-item>
      </form>
    </div>
    <div class="action" [class.only-button]="isEdit">
      <div *ngIf="!isEdit" class="profile switch">
        <span>Giảng Viên</span>
        <nz-switch [(ngModel)]="selectedRoleStudent"></nz-switch>
        <span>Sinh Viên</span>
      </div>
      <button
        (click)="createPerson()"
        nzShape="round"
        nz-button
        nzType="primary"
      >
        {{ isEdit ? "Cập Nhật" : "Tạo" }}
      </button>
    </div>
  </div>

  <div *ngIf="selectedTab === 'pictures'" class="pictures bar">
    <div class="left" style="width: 50%">
      <div class="clearfix">
        <nz-upload
          [nzFileType]="'image/png,image/jpeg'"
          [nzMultiple]="true"
          [nzAction]="uploadPicLink"
          nzListType="picture-card"
          [(nzFileList)]="fileList"
          [nzShowButton]="fileList.length < 20"
          [nzPreview]="handlePreview"
          [nzRemove]="handleRemove"
          (nzChange)="handleReq($event)"
        >
          <div>
            <span nz-icon nzType="plus"></span>
            <div style="margin-top: 8px">Upload</div>
          </div>
        </nz-upload>

        <nz-modal
          [nzVisible]="previewVisible"
          [nzContent]="modalContent"
          [nzFooter]="null"
          (nzOnCancel)="previewVisible = false"
        >
          <ng-template #modalContent>
            <img [src]="previewImage" [ngStyle]="{ width: '100%' }" />
          </ng-template>
        </nz-modal>
      </div>
      <div class="action-bar">
        <button (click)="startCam()" nz-button nzType="primary">
          Chụp Ảnh Trực Tiếp
        </button>
        <button
          *ngIf="fileList.length"
          [nzLoading]="isLoadingTrainModel"
          (click)="updateDataModel()"
          nz-button
          nzType="primary"
        >
          Đồng Bộ Mô Hình
        </button>
      </div>
    </div>

    <div [hidden]="!startCamera" class="right" style="width: 50%">
      <h2>Thêm ảnh cá nhân bằng Camera trực tiếp</h2>

      <div class="flex">
        <div class="child" style="display: flex">
          <video id="video" width="320" height="240" autoplay></video>
          <button
            id="click-photo"
            nz-button
            nzType="primary"
            (click)="capImage()"
          >
            Chụp Ảnh
          </button>
        </div>

        <div class="child" style="margin-left: 1rem">
          <canvas
            id="canvas"
            width="320"
            height="240"
            style="margin-left: 1rem"
          ></canvas>
          <button
            id="click-photo"
            nz-button
            nzType="primary"
            (click)="uploadImage()"
          >
            Tải Lên Ảnh
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
